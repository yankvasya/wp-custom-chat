"use strict";(self.webpackChunkwp_custom_chat=self.webpackChunkwp_custom_chat||[]).push([[514,3],{766:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});const s='<!doctype html> <html lang="ru"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <title>CUSTOM CHAT | WP</title> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500&display=swap" rel="stylesheet"> </head> <body> <div class="wrapper"> <div class="container hide"> <aside class="aside hidden"> <ul class="aside__button"> <li class="button__element"></li> <li class="button__element"></li> <li class="button__element"></li> </ul> <div class="aside__profile"> <div class="profile"> <a href="#" class="profile__img"> <img class="profile__picture" src="https://avavatar.ru/images/avatars/2/avatar_X45iWdICzBLrkbJs.jpg" alt="avatar"> </a> <div class="profile__nickname"></div> </div> <ul class="profile__nicknames"> Онлайн: </ul> </div> </aside> <div class="chat"> <div class="chat__header"> <h3 class="chat__title">Чат</h3> <a href="#" id="allMembers" class="chat__members">0 участников</a> </div> <ul id="messageContainer" class="chat__all-messages"> </ul> <div class="messaging"> <label class="messaging__input-label"><input autocomplete="off" id="messageText" name="nickname" type="text" placeholder="Введите сообщение..." class="messaging__input"></label> <button id="sendMessage" type="submit" class="messaging__send-button">Отправить</button> </div> </div> </div> <div class="login hide none"> <img class="login__img" src="https://i.ibb.co/FxBFRxc/Group-1.png" alt="login img"> <h2 class="login__title">Авторизация</h2> <p class="login__text">Введите пожалуйста свой ник для дальнейшей авторизации</p> <label><input autocomplete="off" class="login__input" id="loginInput" name="nickname" type="text" placeholder="Введите свой ник"> </label> <button class="login__submit" type="submit" id="login">Войти</button> <span class="login__error"></span> <div id="loginLoading" class="login__loading hide"></div> </div> </div> <div class="img hidden none"> <a href="#" class="img__close"></a> <h4 class="img__title">Загрузка фото</h4> <form class="img__content"> <label for="imageUpload"> <img src="https://i.ibb.co/0m3MXtN/Vector.png" alt="no photo" class="img__img"> <input id="imageUpload" accept=".jpg, .jpeg, .png" type="file" name="avatar" class="img__link"> </label> <h3 class="img__nickname">Nickname</h3> </form> </div> <script type="text" id="addFullMessageTemplate"> <h4 class="member__nickname">{{nickname}}</h4>\n        <img class="member__img" src={{avatar}}>\n        <div class="member__message message">\n        <div class="message__text">{{message}}</div>\n        <time class="message__time" datetime={{fullDate}}>{{currentTime}}</time>\n        </div> <\/script> <script type="text" id="addMessageTemplate"> <div class="member__message message">\n        <div class="message__text">{{message}}</div>\n        <time class="message__time" datetime={{fullDate}}>{{currentTime}}</time>\n        </div> <\/script> <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"><\/script> </body> </html> '},689:(e,t,n)=>{var s=n(384),i=n(629);const a=document.querySelector(".container");function l(e){return new Promise((t=>{e.preventDefault();const n=document.querySelector(".login__error"),i=document.querySelector("#login").previousElementSibling.children[0].value,l=function(e){let t=!0;return""===e&&(t="Пустое поле!"),!isNaN(Number([...e][0]))&&(t="Никнейм не должен начинаться с цифры!"),e.length<5&&(t="Меньше 5 знаков!"),["[","]","{","}",",",".","=","+","$","#",'"',"!",";",":","<",">","?","'","|","*","&","№"].forEach((n=>e.includes(n)?t="Содержит недопустимый(-ые) символ(-ы)":null)),t}(i);!0===l?(document.querySelector("#login").disabled=!0,async function(e){return new Promise((t=>{const n=document.getElementById("loginLoading");let s,{position:i,interval:a,i:l}={position:64,interval:10,i:0};n.classList.remove("hide"),s=setInterval((()=>{100===l&&(n.classList.add("hide"),t(e),clearInterval(s)),l++,n.style.backgroundPositionX=`-${i}px`,i<1792?i+=64:i=64}),a)}))}(i).then((e=>{(0,s.kE)(e);const n=document.querySelector(".login"),i={type:"join",payload:{nickname:e,avatar:sessionStorage.getItem("recent-image")||"https://avavatar.ru/images/avatars/2/avatar_X45iWdICzBLrkbJs.jpg"}};document.cookie=`nickname=${e}`,n.classList.add("hide"),a.classList.remove("hide"),setTimeout((()=>{n.classList.add("none"),a.classList.add("visible")}),300),t(JSON.stringify(i))}))):(n.innerHTML=`*- ${l}`,n.classList.add("visible"))}))}n(766);const c=document.querySelector("#login"),o=document.querySelector("#loginInput"),r=document.querySelector(".aside__button"),d=document.querySelector("#sendMessage"),m=document.querySelector("#messageText"),u=document.querySelector(".login"),g=document.querySelector("#allMembers"),p=document.querySelector(".profile__img"),v=document.querySelector(".img__close"),f=document.querySelector(".img"),_=document.querySelector(".img__link");window.addEventListener("load",(()=>{u.classList.remove("hide"),u.classList.remove("none")})),o.addEventListener("input",(()=>{document.querySelector(".login__error").classList.remove("visible")})),o.addEventListener("keyup",(e=>{"Enter"===e.key&&!c.disabled&&l(e).then((e=>(0,i.K4)(e)))})),c.addEventListener("click",(e=>{l(e).then((e=>(0,i.K4)(e)))})),d.addEventListener("click",(()=>{m.value.length>0&&(0,i.bG)()})),m.addEventListener("keyup",(e=>{"Enter"===e.key&&m.value.length>0&&(0,i.bG)()})),r.addEventListener("click",(()=>{const e=document.querySelector(".aside");e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden")})),g.addEventListener("click",(e=>{e.preventDefault(),console.log("clicked")})),p.addEventListener("click",(e=>{e.preventDefault(),f.classList.remove("none"),setTimeout((()=>{f.classList.remove("hidden")}),100)})),v.addEventListener("click",(e=>{e.preventDefault(),y()}));let h=!1;const b=document.querySelector(".profile__picture");function y(){f.classList.add("hidden"),setTimeout((()=>{f.classList.add("none")}),500)}document.addEventListener("DOMContentLoaded",(()=>{const e=sessionStorage.getItem("recent-image");e&&(b.setAttribute("src",e),b.src=`${e}`),_.addEventListener("click",(()=>{h=!0;let e=document.querySelector(".img__error");e&&(e.innerHTML="")})),_.addEventListener("change",(function(){this.files[0]&&(Math.ceil(this.files[0].size/1024)<2048?(0,s.zb)("newAvatar",this).then()&&y():document.querySelector(".img__content").insertAdjacentHTML("afterend",'<div class="img__error">Максимально допустимый размер изображение превышен! (2047mb)</div>'))}))})),document.addEventListener("keyup",(e=>{"Escape"===e.key&&!f.classList.contains("hidden")&&!h&&y(),h=!1}))},384:(e,t,n)=>{n.d(t,{kE:()=>c,zb:()=>d});var s=n(629);let i="https://avavatar.ru/images/avatars/2/avatar_X45iWdICzBLrkbJs.jpg",a={id:0,nickname:"",avatar:i},l={friends:[],online:0};function c(e){a.nickname=e,document.querySelector(".profile__nickname").innerText=`${e}`}function o(e,t){if("join"===t)a.nickname!==e&&document.querySelector(".profile__nicknames").insertAdjacentHTML("beforeend",`<li class="nickname">${e}</li>`);else if("leave"===t&&a.nickname!==e){const t=document.querySelector(".profile__nicknames").children;for(let n=0;n<t.length;n++)t[n].innerText===`${e}`&&t[n].remove()}}function r(e,t){const n=document.querySelector("#messageContainer"),s=`<li class="member join">\n                    <div class="member__join">\n                        <div>${e} ${t}</div>\n                    </div>\n                </li>`;n.insertAdjacentHTML("beforeend",s),n.scrollTop=n.scrollHeight}async function d(e,t,n){switch(e){case"addmessage":await function(e,t){const n=document.createElement("li"),s=document.querySelector("#messageContainer");a.avatar;const i={message:e},c=`${(new Date).getHours()>=10?(new Date).getHours():"0"+(new Date).getHours()}:${(new Date).getMinutes()>=10?(new Date).getMinutes():"0"+(new Date).getMinutes()}`,o={fullDate:`${(new Date).getFullYear()}-${(new Date).getMonth()}-${(new Date).getDay()}T${c}`,currentTime:c},r=s.lastElementChild,d=`{"${document.cookie.split("; ").join('" "').split("=").join('":"').split(" ").join(", ")}"}`,m=JSON.parse(d);m.id=Number(m.id);const u=document.querySelector("#addMessageTemplate").innerHTML,g=Handlebars.compile(u),p=document.querySelector("#addFullMessageTemplate").innerHTML,v=Handlebars.compile(p);let f;if(n.classList.add("member"),m.id===t)f=null===r||r.classList.contains("friend")||r.classList.contains("join")?v(Object.assign(a,i,o)):g(Object.assign(m,i,o)),null===r||r.classList.contains("friend")||r.classList.contains("join")?(n.classList.add("me"),s.appendChild(n)):r.insertAdjacentHTML("beforeend",f);else{const e={};l.friends.forEach((n=>{n.id===t&&(e.nickname=n.nickname,e.avatar=n.avatar)})),console.log(e),f=null===r||r.classList.contains("me")||r.classList.contains("join")||0!==r.firstElementChild.textContent.length&&r.firstElementChild.textContent!==e.nickname?v(Object.assign(e,i,o)):g(Object.assign(i,o)),null===r||r.classList.contains("me")||r.classList.contains("join")||r.firstElementChild.textContent!==e.nickname?(n.classList.add("friend"),s.appendChild(n)):r.insertAdjacentHTML("beforeend",f)}n.innerHTML=f,s.scrollTop=s.scrollHeight}(t.message,t.id);break;case"close":await function(e){const t=l.friends;for(let n=0;n<t.length;n++)t[n].id===e&&(l.online--,m(),r(t[n].nickname,"вышел из чата"),o(t[n].nickname,"leave"),l.friends[n]={})}(t.id);break;case"connection":(0,s.MI)(),sessionStorage.getItem("recent-image")?a.avatar=sessionStorage.getItem("recent-image"):a.avatar=i,await function(e){return new Promise((t=>{document.cookie=`id=${e}`,a.id=Number(e);const n=setInterval((()=>{void 0!==a.nickname&&0!==a.nickname.length&&(clearInterval(n),t(JSON.stringify(a)))}),250)}))}(n);break;case"join":await function(e,t,n){return new Promise((()=>{l.friends.push({id:t,nickname:e,avatar:n}),l.online++,m(),r(e,"присоединился к чату"),o(e,"join")}))}(t.message.nickname,t.id,t.message.avatar);break;case"dataBaseInfo":t.id!==a.id&&(0,s.h0)(l,t.id);break;case"takeDataBaseInfo":t.message.id===a.id&&0===l.friends.length&&function(e){l.friends=e.friends,l.online=e.online,m();for(const e of l.friends)void 0!==e.nickname&&o(e.nickname,"join")}(t.message);break;case"newAvatar":await function(e){const t=new FileReader;t.addEventListener("load",(()=>{sessionStorage.setItem("recent-image",t.result),a.avatar=t.result;const e=document.querySelector(".profile__picture"),n=sessionStorage.getItem("recent-image"),i={type:"friendChangeAvatar",payload:{avatar:n}};(0,s.K4)(JSON.stringify(i)),e.src=`${n}`})),t.readAsDataURL(e.files[0])}(t);break;case"friendChangeAvatar":!function(e,t){l.friends.forEach((n=>{n.id===t&&(n.avatar=e)}))}(t.message.avatar,t.id)}}function m(){const e=l.online,t=document.querySelector(".chat__members");!function(e){const n=["участник","участника","участников"];e<0||(1!==e&&21!==e?e>1||e<5||21<e<25?t.innerText=`${e} ${n[1]}`:(e>10||e<20||e>=25||0===e)&&(t.innerText=`${e} ${n[2]}`):t.innerText=`${e} ${n[0]}`)}(e)}},629:(e,t,n)=>{n.d(t,{bG:()=>c,K4:()=>o,MI:()=>r,h0:()=>d});var s=n(384);const i=new WebSocket("ws://localhost:8999"),a=document.querySelector("#messageText");let l;function c(){const e={type:"addmessage",payload:a.value};i.send(JSON.stringify(e)),a.value=""}function o(e){i.send(e)}function r(){i.send(JSON.stringify({type:"dataBaseInfo",payload:{id:l}}))}function d(e,t){const{friends:n,online:s}=e,a={type:"takeDataBaseInfo",payload:{friends:n,online:s,length:n.length,id:t}};n.length>0&&i.send(JSON.stringify(a))}i.addEventListener("message",(function(e){let t;!function e(n){let s=JSON.parse(n);if("object"!=typeof s?e(s):t=s,void 0!==t.message){const{type:e,payload:n}=JSON.parse(t.message);t={type:e,payload:{message:n,id:t.id}}}}(e.data);const{type:n,payload:i}=t;if(void 0===l)return(0,s.zb)(n,null,i.id).then((e=>e)),l=i.id,void console.warn(`Текущее ID пользователя: ${l}`);(0,s.zb)(n,i).then((e=>{}))})),i.addEventListener("error",(function(){alert("Соединение закрыто или не может быть открыто")}))}},e=>{var t=t=>e(e.s=t);t(689),t(629)}]);